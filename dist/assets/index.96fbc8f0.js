import{u as t,c as e,a as s,h as a,b as n,o as r,d as i,w as o,v as d,e as l,F as c,r as h,t as u,f as g}from"./vendor.28943103.js";var p={wallet:void 0,scrt:void 0,async init(){this.wallet=await t(),this.scrt=await e("https://datahubarchive.stakeordie.workers.dev",this.wallet)},getDatesArray(t,e){var s=t;const a=[];for(;s.isSameOrBefore(e);){const t=s.format("YYYY-MM-DD");a.push({date:t}),s.add(1,"days")}return a},async getArchivalBalance(t,e){const s=await this.wallet.getSnip20ViewingKey(t);void 0===e&&(e=await this.getHeight());const a={balance:{address:await this.wallet.getAddress(),key:s}};return(await this.scrt.queryContract(t,a,{height:e})).balance},async getSefiTransactionHistory(){const t=await this.wallet.getSnip20ViewingKey("secret15l9cqgz5uezgydrglaak5ahfac69kmx2qpd6xt"),e={transfer_history:{address:await this.wallet.getAddress(),key:t,page_size:1e3}},s=await this.scrt.queryContract("secret15l9cqgz5uezgydrglaak5ahfac69kmx2qpd6xt",e);return console.log(s),s.transfer_history.txs},async getSpySefiSignedTxs(t){const e="https://api.stakeordie.com/txs?message.action=execute&message.signer="+await this.wallet.getAddress()+"&message.contract_address="+t;return(await s.get(e)).data.txs.filter((t=>parseInt(t.tx.value.fee.amount[0].amount)>=75e3))},async getSignedTxs(t){const e="https://api.stakeordie.com/txs?message.action=execute&message.signer="+await this.wallet.getAddress()+"&message.contract_address="+t;return(await s.get(e)).data.txs.filter((t=>parseInt(t.tx.value.fee.amount[0].amount)>=75e3))},async getIncentivizedToken(t){return(await this.scrt.queryContract(t,{incentivized_token:{}})).incentivized_token.token.address},getHeight:async()=>(await s.get("https://api.stakeordie.com/blocks/latest")).data.block.last_commit.height,async getSpyUnclaimedRewards(t){const e=await this.wallet.getSnip20ViewingKey(t),s=await this.getHeight(),a={rewards:{address:await this.wallet.getAddress(),key:e,height:parseInt(s)}};return(await this.scrt.queryContract(t,a)).rewards.rewards},async parseSefiTransactionHistory(t,e,s,n){t.sort((function(t,e){return t.id>e.id?1:t.id<e.id?-1:0})),t=t.filter((t=>t.from==n||t.receiver==n));for(let a=0;a<t.length;a++)0!=a?"string"!=typeof t[a].type&&(t[a].receiver!=n?t[a].from==n&&(0==t[a+1].coins.amount?(t[a].type="claim",t[a+1].type="claim_claim"):(t[a].type="with",t[a+1].type="with_claim")):(t[a].type="dep",t[a+1].type="dep_claim")):t[a].type="init_dep";const r=await this.getIncentivizedToken(n),i=await this.getSignedTxs(r);let o;console.log("initAmount",parseInt(t[0].coins.amount));for(let y=0;y<i.length;y++){const e=await this.getArchivalBalance(r,parseInt(i[y].height)-1),s=await this.getArchivalBalance(r,parseInt(i[y].height)),n=parseInt(e.amount)-parseInt(s.amount);if(console.log("delta",n),parseInt(t[0].coins.amount)==n){o=a(i[y].timestamp),console.log(o);break}}let d=[],l=0;for(let a=0;a<t.length;a++)if("dep"!=t[a].type&&"claim_claim"!=t[a].type&&"with"!=t[a].type&&"init_dep"!=t[a].type)if("dep_claim"!=t[a].type){if(l>0){const e=parseInt(t[a].coins.amount)+parseInt(l);t[a].coins.amount=e.toString(),l=0}d.push(t[a])}else l=t[a].coins.amount;console.log("typed_filtered",d);let c,h,u,g=o;console.log(d.length);for(let y=0;y<d.length;y++){const t=a(e[y].timestamp);d[y].timestamp=e[y].timestamp,d[y].date_from=g,d[y].height=e[y].height,d[y].date_to=t,g=t;const s=d[y].date_to.diff(d[y].date_from,"days"),n=d[y].date_to.diff(d[y].date_from,"hours");console.log("hours",n),d[y].days=s,d[y].hours=n}for(let a=0;a<d.length;a++)0==d[a].days?(c=parseInt(d[a].coins.amount),h=0):(c=parseInt(d[a].coins.amount)/d[a].days,h=parseInt(d[a].coins.amount)%d[a].days),d[a].daily_rewards=Math.trunc(c).toString(),d[a].mod=h.toString();if(s>0){u=a();const t=u.diff(g,"days");d.push({coins:{amount:s,denom:"SEFI"},date_from:g,date_to:u,days:u.diff(g,"days"),daily_rewards:Math.trunc(parseInt(s)/t),mod:parseInt(s)%t})}else u=g;console.log("dated&heighted",d);const p=this.getDatesArray(o,u);return console.log(p),p.forEach((t=>{const e=a(t.date,"YYYY-MM-DD"),s=d.find((t=>e.isSameOrBefore(t.date_to)));t.rewards=s.daily_rewards,s.date_to.isSame(e,"day")&&(t.claim=s.coins.amount)})),p}};const y={async mounted(){await p.init()},data:()=>({days:[],spyAddress:"",spyOptions:[{text:"SEFI",value:"secret1y9z3ck449a46r4ku7klkhdxnlq07zh4shc7cuy"},{text:"sSCRT-SEFI",value:"secret1097s3zmexc4mk9s2rdv3gs6r76x9dn9rmv86c7"},{text:"sSCRT-sETH",value:"secret146dg4c7jt5y37nw94swp6sahleshefxhrerpqm"},{text:"sSCRT-sWBTC",value:"secret1a3qvtsxd3fu5spkrscp5wwz3gtjmf50fgruezy"},{text:"sSCRT-sUSDT",value:"secret1zysw570u5edsfdp44q80tm5zhdllawgh603ezy"},{text:"sSCRT-sLINK",value:"secret1mlv3av6nlqt3fmzmtw0pnehsff2dxrzxq98225"},{text:"sSCRT-sRSR",value:"secret1rxu6rksvyaxksnhqszv06d3n92y0prgr2ghj5m"},{text:"sSCRT-sRUNE",value:"secret16wup0xc9m5ndgvna3p523xntk7favp353xa79v"},{text:"sSCRT-sUNI",value:"secret13gdhmsf5j9jjva6d924hhdjrngf8092tv5frp8"},{text:"sSCRT-sOCEAN",value:"secret1zpz7x64lm625k0rxgk6z0drffz5hwwsnnwaxkf"},{text:"sSCRT-sYFI",value:"secret1d5qkesgrhhpcvkaephrs5ws7nvankrkgf32un5"},{text:"sSCRT-sDAI",value:"secret1fc3w26lv0t2q8j2u0rrc7cf5mycde9sqg8jjf6"},{text:"sSCRT-sMANA",value:"secret1358gj5s2ys859tuue6v43w98jzavfnh8d8gz8y"},{text:"sETH-sWBTC",value:"secret1mznq6qwlj3ryzfpetfgydffef7w40tmlkhufcl"}]}),methods:{coinConvert:n,async doit(){const t=await p.getSefiTransactionHistory(this.spyAddress),e=await p.getSpySefiSignedTxs(this.spyAddress);console.log(e);const s=await p.getSpyUnclaimedRewards(this.spyAddress);this.days=await p.parseSefiTransactionHistory(t,e,s,this.spyAddress),console.log(this.days)}}},m=l("label",{for:"spyAddress"},"SPY Address",-1),f=l("option",{disabled:"",value:""},"Select a Farm",-1),w=l("br",null,null,-1),v=l("thead",null,[l("tr",null,[l("th",null,"Date"),l("th",null,"Claim"),l("th",null,"Est. Daily Rewards")])],-1);y.render=function(t,e,s,a,n,g){return r(),i(c,null,[m,o(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>n.spyAddress=t)},[f,(r(!0),i(c,null,h(n.spyOptions,((t,e)=>(r(),i("option",{key:e,value:t.value},u(t.text),9,["value"])))),128))],512),[[d,n.spyAddress]]),w,l("button",{onClick:e[2]||(e[2]=(...t)=>g.doit&&g.doit(...t))},"Get Rewards"),l("table",null,[v,l("tbody",null,[(r(!0),i(c,null,h(n.days,((t,e)=>(r(),i("tr",{key:e},[l("td",null,u(t.date),1),l("td",null,u(g.coinConvert(t.claim,6,"human",4)),1),l("td",null,u(g.coinConvert(t.rewards,6,"human",4)),1)])))),128))])])],64)},p.init().then((()=>{g(y).mount("#app")}));
